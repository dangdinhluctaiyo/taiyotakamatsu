<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>TaiyoTakamatsu Rental</title>

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#007AFF" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="TaiyoRental" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="apple-touch-icon" href="/icons/icon-192.png" />

  <!-- Performance: DNS Prefetch & Preconnect -->
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Critical: Preload fonts for faster rendering -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style"
    onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  </noscript>

  <!-- Preload critical CSS -->
  <link rel="preload" href="/index.css" as="style">
  <link rel="preload" href="/src/styles/ios-theme.css" as="style">

  <!-- External scripts with async for non-blocking -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript" async></script>

  <!-- Tailwind config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'sans-serif'],
          },
          colors: {
            primary: '#2563eb',
            primaryDark: '#1e40af',
            secondary: '#64748b',
            background: '#f8fafc',
            surface: '#ffffff',
          },
          boxShadow: {
            'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
            'glow': '0 0 15px rgba(37, 99, 235, 0.2)',
          }
        }
      }
    }
  </script>

  <!-- Import map for React -->
  <script type="importmap">
{
  "imports": {
    "recharts": "https://aistudiocdn.com/recharts@^3.5.1",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0"
  }
}
</script>

  <!-- Load CSS -->
  <link rel="stylesheet" href="/index.css">
  <link rel="stylesheet" href="/src/styles/ios-theme.css">

  <!-- Critical CSS inline for faster first paint -->
  <style>
    /* Critical CSS for immediate render */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: #f8fafc;
      overflow-x: hidden;
    }

    #root {
      min-height: 100vh;
    }

    /* Loading spinner */
    .app-loading {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f8fafc;
      z-index: 9999;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #e2e8f0;
      border-top-color: #2563eb;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Reduce motion for accessibility & performance */
    @media (prefers-reduced-motion: reduce) {

      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* GPU acceleration hints */
    .ios-tab-bar,
    .ios-tab-item {
      will-change: transform;
      transform: translateZ(0);
    }
  </style>
</head>

<body class="bg-background text-slate-800 antialiased">
  <!-- Loading screen while app initializes -->
  <div id="root">
    <div class="app-loading" id="app-loader">
      <div class="spinner"></div>
    </div>
  </div>

  <script type="module" src="/index.tsx"></script>

  <!-- Register Service Worker immediately -->
  <script>
    // Hide loader when app is ready
    window.addEventListener('DOMContentLoaded', () => {
      const loader = document.getElementById('app-loader');
      if (loader) {
        setTimeout(() => {
          loader.style.opacity = '0';
          loader.style.transition = 'opacity 0.3s';
          setTimeout(() => loader.remove(), 300);
        }, 100);
      }
    });

    // Register Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
        .then((registration) => {
          console.log('PWA: Service Worker registered');

          // Check for updates
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // New version available
                console.log('PWA: Update available');
              }
            });
          });
        })
        .catch((error) => {
          console.log('PWA: Service Worker registration failed', error);
        });
    }
  </script>
</body>

</html>